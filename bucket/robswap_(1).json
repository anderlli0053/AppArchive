{
  "version": "3.1.0",
  "description": "Convert programs from one robot vendor to another",
  "homepage": "https://icarus-consult.de",
  "license": "non-free",
  "url": "//promptly-apps.icarus-consult.local/Software/TMXTOOLS/robswap/3.1.0/RobSwap 3.1.0.msi",
  "autoupdate": {
    "url": "//promptly-apps.icarus-consult.local/Software/TMXTOOLS/robswap/$version/RobSwap $version.msi"
  },
  "pre_install": [
    "if(Get-Process -Name \"tune\" -ErrorAction SilentlyContinue) {",
    "    Write-Error \"Process Simulate is running. Please close it to continue.\"",
    "    exit 1",
    " }"
  ],
  "post_install": [
    "# Rewrite config file",
    "$executable = $dir + \"\\ABSOLUTEPATH\\RobSwap\\RobSwap.App.exe\"",
    "$configPath = $dir + \"\\ProgramFiles64Folder\\Tecnomatix\\eMPower\\DotNetCommands\\RobSwap\\config.xml\"",
    "[xml]$configXML = Get-Content $configPath;",
    "$configXML.PreserveWhitespace = $true;",
    "$configXML.SelectNodes(\"/config\")[0].executable = $executable;",
    "$configXML.Save($configPath);",
    "",
    "# Copy to emPower Directory",
    "$emPowerDir = \"\";",
    "if(Test-Path -Path 'HKLM:\\SOFTWARE\\TecnomatixRoot') {",
    "        Write-Host Shared Tecnomatix is installed",
    "        $shared = Get-ItemPropertyValue -Path 'HKLM:\\SOFTWARE\\TecnomatixRoot\\' -Name SymbolicLinkLocation",
    "        $emPowerDir = $shared + \"TecnomatixCurrent\\eMPower\"",
    "        if(!(Test-Path -Path $emPowerDir)) {",
    "               $emPowerDir = Get-ItemPropertyValue -Path 'HKLM:\\SOFTWARE\\Tecnomatix\\eMPower' -Name eMPowerDir",
    "        }",
    "} elseif(Test-Path -Path 'HKLM:\\SOFTWARE\\Tecnomatix\\eMPower') {",
    "        Write-Host Single Tecnomatix is installed",
    "        $emPowerDir = Get-ItemPropertyValue -Path 'HKLM:\\SOFTWARE\\Tecnomatix\\eMPower' -Name eMPowerDir",
    "} else {",
    "        Write-Host Could not find a valid Tecnomatix Installation",
    "}",
    "Write-Host \"Tecnomatix detected at \" $emPowerDir",
    "$xmls = $dir + \"\\ProgramFiles64Folder\\Tecnomatix\\eMPower\\DotNetExternalApplications\"",
    "Copy-Item $xmls -Destination $eMPowerDir -Force -Recurse",
    "$cmds = $dir + \"\\ProgramFiles64Folder\\Tecnomatix\\eMPower\\DotNetCommands\"",
    "Copy-Item $cmds -Destination $eMPowerDir -Force -Recurse"
  ],
  "pre_uninstall": [
    "if(Get-Process -Name \"tune\" -ErrorAction SilentlyContinue) {",
    "    Write-Error \"Process Simulate is running. Please close it to continue.\"",
    "    exit 1",
    " }"
  ],
  "post_uninstall": [
    "# Copy to emPower Directory",
    "$emPowerDir = \"\";",
    "if(Test-Path -Path 'HKLM:\\SOFTWARE\\TecnomatixRoot') {",
    "        Write-Host Shared Tecnomatix is installed",
    "        $shared = Get-ItemPropertyValue -Path 'HKLM:\\SOFTWARE\\TecnomatixRoot\\' -Name SymbolicLinkLocation",
    "        $emPowerDir = $shared + \"TecnomatixCurrent\\eMPower\"",
    "        if(!(Test-Path -Path $emPowerDir)) {",
    "               $emPowerDir = Get-ItemPropertyValue -Path 'HKLM:\\SOFTWARE\\Tecnomatix\\eMPower' -Name eMPowerDir",
    "        }",
    "} elseif(Test-Path -Path 'HKLM:\\SOFTWARE\\Tecnomatix\\eMPower') {",
    "        Write-Host Single Tecnomatix is installed",
    "        $emPowerDir = Get-ItemPropertyValue -Path 'HKLM:\\SOFTWARE\\Tecnomatix\\eMPower' -Name eMPowerDir",
    "} else {",
    "        Write-Host Could not find a valid Tecnomatix Installation",
    "}",
    "Write-Host \"Tecnomatix detected at \" $emPowerDir",
    "$cmd = $emPowerDir + \"\\DotNetCommands\\RobSwap\"",
    "Remove-Item -Recurse -Force $cmd",
    "$xml = $emPowerDir + \"\\DotNetExternalApplications\\RobSwap.Tmx.Plugin.xml\"",
    "Remove-Item -Recurse -Force $xml"
  ]
}